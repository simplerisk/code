{"version":3,"file":"regression-spec.js","sourceRoot":"","sources":["../../spec/regression-spec.ts"],"names":[],"mappings":"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","sourcesContent":["import { GridItemHTMLElement, GridStack, GridStackWidget } from '../src/gridstack';\r\n\r\ndescribe('regression >', () => {\r\n  'use strict';\r\n\r\n  let grid: GridStack;\r\n  let findEl = function(id: string): GridItemHTMLElement {\r\n    return grid.engine.nodes.find(n => n.id === id)!.el!;\r\n  };\r\n  let findSubEl = function(id: string, index = 0): GridItemHTMLElement {\r\n    return grid.engine.nodes[index].subGrid?.engine.nodes.find(n => n.id === id)!.el!;\r\n  };\r\n\r\n\r\n  // empty grid\r\n  let gridstackEmptyHTML =\r\n  '<div style=\"width: 800px; height: 600px\" id=\"gs-cont\">' +\r\n  '  <div class=\"grid-stack\"></div>' +\r\n  '</div>';\r\n\r\n  describe('2492 load() twice >', () => {\r\n    beforeEach(() => {\r\n      document.body.insertAdjacentHTML('afterbegin', gridstackEmptyHTML);\r\n    });\r\n    afterEach(() => {\r\n      document.body.removeChild(document.getElementById('gs-cont'));\r\n    });\r\n    it('', () => {\r\n      let items: GridStackWidget[] = [\r\n        {x: 0, y: 0, w:2, content: '0 wide'},\r\n        {x: 1, y: 0, content: '1 over'},\r\n        {x: 2, y: 1, content: '2 float'},\r\n      ];\r\n      let count = 0;\r\n      items.forEach(n => n.id = String(count++));\r\n      grid = GridStack.init({cellHeight: 70, margin: 5}).load(items);\r\n\r\n      let el0 = findEl('0');\r\n      let el1 = findEl('1');\r\n      let el2 = findEl('2');\r\n\r\n      expect(el0.getAttribute('gs-x')).toBe(null);\r\n      expect(el0.getAttribute('gs-y')).toBe(null);\r\n      expect(el0.children[0].innerHTML).toBe(items[0].content!);\r\n      expect(parseInt(el1.getAttribute('gs-x'))).toBe(1);\r\n      expect(parseInt(el1.getAttribute('gs-y'))).toBe(1);\r\n      expect(parseInt(el2.getAttribute('gs-x'))).toBe(2);\r\n      expect(el2.getAttribute('gs-y')).toBe(null);\r\n\r\n      // loading with changed content should be same positions\r\n      items.forEach(n => n.content += '*')\r\n      grid.load(items);\r\n      expect(el0.getAttribute('gs-x')).toBe(null);\r\n      expect(el0.getAttribute('gs-y')).toBe(null);\r\n      expect(el0.children[0].innerHTML).toBe(items[0].content!);\r\n      expect(parseInt(el1.getAttribute('gs-x'))).toBe(1);\r\n      expect(parseInt(el1.getAttribute('gs-y'))).toBe(1);\r\n      expect(parseInt(el2.getAttribute('gs-x'))).toBe(2);\r\n      expect(el2.getAttribute('gs-y')).toBe(null);\r\n    });\r\n  });\r\n\r\n  describe('2865 nested grid resize >', () => {\r\n    beforeEach(() => {\r\n      document.body.insertAdjacentHTML('afterbegin', gridstackEmptyHTML);\r\n    });\r\n    afterEach(() => {\r\n      document.body.removeChild(document.getElementById('gs-cont'));\r\n    });\r\n    it('', () => {\r\n      let children: GridStackWidget[] = [{},{},{}];\r\n      let items: GridStackWidget[] = [\r\n        {x: 0, y: 0, w:3, h:5, sizeToContent: true, subGridOpts: {children, column: 'auto'}}\r\n      ];\r\n      let count = 0;\r\n      [...items, ...children].forEach(n => n.id = String(count++));\r\n      grid = GridStack.init({cellHeight: 70, margin: 5, children: items});\r\n\r\n      let nested = findEl('0');\r\n      let el1 = findSubEl('1');\r\n      let el2 = findSubEl('2');\r\n      let el3 = findSubEl('3');\r\n      expect(nested.getAttribute('gs-x')).toBe(null);\r\n      expect(nested.getAttribute('gs-y')).toBe(null);\r\n      expect(parseInt(nested.getAttribute('gs-w'))).toBe(3);\r\n      // TODO: sizeToContent doesn't seem to be called in headless mode ??? works in browser.\r\n      // expect(nested.getAttribute('gs-h')).toBe(null); // sizeToContent 5 -> 1 which is null\r\n      expect(el1.getAttribute('gs-x')).toBe(null);\r\n      expect(el1.getAttribute('gs-y')).toBe(null);\r\n      expect(parseInt(el2.getAttribute('gs-x'))).toBe(1);\r\n      expect(el2.getAttribute('gs-y')).toBe(null);\r\n      expect(parseInt(el3.getAttribute('gs-x'))).toBe(2);\r\n      expect(el3.getAttribute('gs-y')).toBe(null);\r\n\r\n      // now resize the nested grid to 2 -> should reflow el3\r\n      grid.update(nested, {w:2});\r\n      expect(nested.getAttribute('gs-x')).toBe(null);\r\n      expect(nested.getAttribute('gs-y')).toBe(null);\r\n      expect(parseInt(nested.getAttribute('gs-w'))).toBe(2);\r\n      // TODO: sizeToContent doesn't seem to be called in headless mode ??? works in browser.\r\n      // expect(parseInt(nested.getAttribute('gs-h'))).toBe(2);\r\n      expect(el1.getAttribute('gs-x')).toBe(null);\r\n      expect(el1.getAttribute('gs-y')).toBe(null);\r\n      expect(parseInt(el2.getAttribute('gs-x'))).toBe(1);\r\n      expect(el2.getAttribute('gs-y')).toBe(null);\r\n      // 3rd item pushed to next row\r\n      expect(el3.getAttribute('gs-x')).toBe(null);\r\n      expect(parseInt(el3.getAttribute('gs-y'))).toBe(1);\r\n    });\r\n  });\r\n});\r\n"]}